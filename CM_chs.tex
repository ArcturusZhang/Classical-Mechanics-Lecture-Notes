\documentclass[UTF8,a4paper,openany]{ctexbook}
\usepackage{zhnumber}
% \usepackage[draft]{graphicx}
\usepackage{graphicx}
\usepackage{subfigure}

\usepackage{latexsym, amsmath, amssymb, amsfonts, mathrsfs, amsthm}
\usepackage{siunitx}

\usepackage{cases}

\usepackage{multirow}
\usepackage{textcomp}
\usepackage[top=2.54cm, bottom=2.54cm, left=3.18cm, right=3.18cm]{geometry}
\usepackage[toc,lof]{multitoc}

\usepackage{asymptote}

\usepackage{hyperref}
\hypersetup{colorlinks,
	linkcolor=black,
	filecolor=black,
	urlcolor=blue,
	citecolor=black,
	pdftitle={《经典力学》讲稿},
	pdfauthor={张大鹏},
	pdfsubject={经典力学, 分析力学},
	pdfkeywords={经典力学, 分析力学},
	pdfproducer={XeLaTeX},
	pdfborder=0 0 1}

\setcounter{secnumdepth}{3} %使subsubsection也有编号

\usepackage{fancyhdr}	%页眉页脚

\usepackage[inline]{enumitem}
\setlist[enumerate,1]{leftmargin=0pt,itemindent=2em,itemsep=0ex,listparindent=2em,parsep = 0ex,topsep = 1ex}
\setlist[enumerate,2]{leftmargin=1em,itemsep=0ex,itemindent=2em,listparindent=2em,parsep = 0ex,topsep = 1ex}
\setlist[enumerate,3]{leftmargin=1em,itemsep=0ex,itemindent=2em,listparindent=2em,parsep = 0ex,topsep = 1ex}
\setlist[itemize,1]{itemsep = 0ex, parsep = 0ex, topsep = 1ex}
\setlist[description]{listparindent=2em, itemsep=0ex, parsep = 0ex,topsep = 1ex}

\ctexset{
	figurename={\kaishu 图},
	tablename={表},
	contentsname={目\quad 录},
	listfigurename={插图目录}
}

\newcommand{\ds}{\displaystyle}
\newcommand{\eps}{\varepsilon}
\newcommand{\mbf}{\boldsymbol}
\newcommand{\mrm}[1]{\boldsymbol{\mathnormal{#1}}}
\newcommand{\bnb}{\mbf{\nabla}}
\newcommand{\pl}{\partial}
\newcommand{\arcosh}{\mathrm{arcosh}\,}
\newcommand{\sn}{\mathrm{sn}\,}
\newcommand{\cn}{\mathrm{cn}\,}
\newcommand{\tn}{\mathrm{tn}\,}
\newcommand{\dn}{\mathrm{dn}\,}
\newcommand{\am}{\mathrm{am}\,}
\newcommand{\mathd}{\mathrm{d}}
\newcommand{\mathe}{\mathrm{e}}
\newcommand{\mathi}{\mathrm{i}}
\newcommand{\mathj}{\mathrm{j}}
\newcommand{\mathk}{\mathrm{k}}
\renewcommand{\vec}{\overrightarrow}
\renewcommand{\bf}{\heiti}
\renewcommand{\bfseries}{\heiti}
\newcommand{\ddt}{\dfrac{\mathd}{\mathd t}}
\newcommand{\difOp}[1]{\dfrac{\mathd}{\mathd #1}}
\newcommand{\dif}[2]{\dfrac{\mathd #1}{\mathd #2}}
\newcommand{\pldif}[2]{\dfrac{\pl #1}{\pl #2}}
\newcommand{\trans}{\mathrm{T}}
\renewcommand{\Re}{\mathrm{Re}\,}
\renewcommand{\Im}{\mathrm{Im}\,}

\newtheoremstyle{theoremwithoutdot}% 类型名
  {}%                   Space above, empty = `usual value'
  {}%                   Space below
  {\kaishu}%                   Body font
  {}%         Indent amount (empty = no indent, \parindent = para indent)
  {\heiti}%          Thm head font
  {}%                   Punctuation after thm head
  {1em}%                Space after thm head
  {\thmname{#1}\thmnumber{~#2}\thmnote{~(#3)}}%                   Thm head spec
  
 \newtheoremstyle{solutionstyle}% 类型名
  {}%                   Space above, empty = `usual value'
  {}%                   Space below
  {}%                   Body font
  {}%         Indent amount (empty = no indent, \parindent = para indent)
  {\heiti}%          Thm head font
  {}%                   Punctuation after thm head
  {1em}%                Space after thm head
  {\thmname{#1}\thmnumber{~#2}\thmnote{~(#3)}}%                   Thm head spec

\theoremstyle{theoremwithoutdot}
\newtheorem{defi}{定义}[section]
\newtheorem{theorem}{定理}[section]
\newtheorem{lemma}[theorem]{引理}
\newtheorem{prop}[theorem]{命题}
\newtheorem{coro}{推论}[theorem]
\newtheorem{remark}{注}
\newtheorem{example}{例}[chapter]
\newtheorem{question}{题}[section]
\newtheorem{property}[theorem]{性质}
%\renewcommand{\thequestion}{\arabic{chapter}.\arabic{section}.\arabic{question}}
%\theoremstyle{solutionstyle}
\newtheorem*{solution}{解}
%去掉证明后面的点
\makeatletter
\renewenvironment{proof}[1][\proofname]{\par%
\pushQED{\qed}%
\normalfont \topsep6\p@\@plus6\p@\relax%
\trivlist%
\item[\hskip\labelsep%
#1]\ignorespaces%
}{%
\popQED\endtrivlist\@endpefalse%
}
\makeatother
\renewcommand{\proofname}{{\heiti 证明}}

%\renewcommand{\thefootnote}{\fnsymbol{footnote}}
%带圈脚注
\usepackage{pifont}
\usepackage[perpage,stable]{footmisc}  %每页脚注重新编号
\renewcommand{\thefootnote}{\ding{\numexpr191+\value{footnote}}}
% 脚注中的脚注序号不用上标，正文中的脚注号保持不变
\makeatletter
\def\my@makefnmark{\hbox{\normalfont\@thefnmark\space}}
\let\my@save@makefntext\@makefntext
\long\def\@makefntext#1{{%
  \let\@makefnmark\my@makefnmark
  \my@save@makefntext{#1}}}

\allowdisplaybreaks[3]

\title{《经典力学》讲义}
\author{整理：张大鹏\thanks{基于徐晓华2010年的《经典力学》讲义整理，有修改和删节。所有插图均为重新绘制。}\\ Email:\url{ufo54153@gmail.com}}
%\date{}

\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
\hbox{}
\vspace*{\fill}

\vspace{\fill}
\thispagestyle{empty}
\newpage
\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother

%在插图目录图编号前加上“图”
%\usepackage{titletoc}
%\titlecontents{figure}[0.5cm]{\songti}{\figurename~\thecontentslabel\quad}{\hspace*{-1.5cm}}{\titlerule*[0.12cm]{.}\contentspage}[\addvspace{6pt}]

%样式定义
\usepackage{titlesec}
\usepackage{xcolor,colortbl}
\usepackage{tgpagella}
\usepackage[T1]{fontenc}
 
\definecolor{partcolor}{RGB}{255,0,128}
\definecolor{titlecolor}{RGB}{129,129,188}
\definecolor{contentcolor}{RGB}{129,188,129}
\definecolor{backcolor}{RGB}{129,188,129}

\newcommand{\mypart}[1]{
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
	\arrayrulewidth=0.4pt
	\cellcolor{black} & \cellcolor{partcolor} \textcolor{white}
	{\newline\heiti\Huge 第\thepart 部分} \\
	\hline
	\cellcolor{black} & \multicolumn{1}{r}{\cellcolor{partcolor} \textcolor{white}
	{\huge #1}}
\end{tabular}
\arrayrulewidth=0.4pt
}
 
\newcommand{\mytitle}[1]{
\begin{tabular}{p{0.01\textwidth}p{0.98\textwidth}}
\cellcolor{black} &\cellcolor{titlecolor} \textcolor{white}
{\newline\heiti\LARGE 第\zhnumber{\thechapter}章 \  \ #1}
\end{tabular}
\arrayrulewidth=0.4pt
}
 
\newcommand{\mycont}[1]{
\vspace{-0.5cm}
\begin{tabular}{p{0.01\textwidth}p{0.98\textwidth}}
\cellcolor{black} &\cellcolor{contentcolor} \textcolor{white}
{\newline\heiti\LARGE #1}
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-1.5cm}
}
 
\newcommand{\mysection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{titlecolor}
\begin{tabular}{p{0.01\textwidth}p{0.98\textwidth}}
\hline
\cellcolor{titlecolor} &  \textcolor{black}{\heiti\LARGE \thesection ~ #1}
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.7cm}
}

\newcommand{\mysubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{titlecolor}
\begin{tabular}{p{0.01\textwidth}p{0.98\textwidth}}
\hline
\cellcolor{titlecolor} &  \textcolor{black}{\heiti\Large \thesubsection ~ #1} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}

\newcommand{\mysubsubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{titlecolor}
\begin{tabular}{p{0.01\textwidth}p{0.975\textwidth}p{0.01\textwidth}}
\hline
\cellcolor{titlecolor} &  \textcolor{black}{\heiti\large \thesubsubsection ~ #1} & \cellcolor{titlecolor} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}


\newcommand{\myappendix}[1]{
\begin{tabular}{p{0.01\textwidth}p{0.98\textwidth}}
\cellcolor{black} &\cellcolor{backcolor} \textcolor{white}
{\newline\heiti\LARGE 附录\thechapter \  \ #1}
\end{tabular}
\arrayrulewidth=0.4pt
}

 
\newcommand{\appendixsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{backcolor}
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\hline
\cellcolor{backcolor} &  \textcolor{black}{\heiti\LARGE \thesection ~ #1}
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.7cm}
}

\newcommand{\appendixsubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{backcolor}
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\hline
\cellcolor{backcolor} &  \textcolor{black}{\heiti\Large \thesubsection ~ #1} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}

\newcommand{\appendixsubsubsection}[1]{
\setlength\arrayrulewidth{1pt}\arrayrulecolor{backcolor}
\begin{tabular}{p{0.01\textwidth}p{0.95\textwidth}p{0.01\textwidth}}
\hline
\cellcolor{backcolor} &  \textcolor{black}{\heiti\large \thesubsubsection ~ #1} & \cellcolor{backcolor} \\
\hline
\end{tabular}
\arrayrulewidth=0.4pt
\vspace{-0.5cm}
}

\newcommand{\mybackmatter}[1]{
\begin{tabular}{p{0.01\textwidth}p{0.99\textwidth}}
\cellcolor{black} &\cellcolor{backcolor} \textcolor{white}
{\newline\heiti\LARGE #1}
\end{tabular}
\arrayrulewidth=0.4pt
}

\begin{document}

\begin{asydef}
	texpreamble("\usepackage{xeCJK}");
	texpreamble("\setCJKmainfont{SimSun}");
	usepackage("amsmath");
	usepackage("amssymb");
	usepackage("siunitx");
	import graph;
	import math;
\end{asydef}

\maketitle

\frontmatter

\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{第\zhnumber{\thechapter}章\ \ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ \ \rm #1}{}}	%这两个命令第一次必须出现在\pagestyle{fancy}之后，否则\pagestyle{fancy}会覆盖掉其效果
\markboth{\leftmark}{\rightmark}
\fancyhf{}
\fancyhead[CO]{\rightmark}
\fancyhead[LE,RO]{$\cdot$\, \thepage\, $\cdot$}
\fancyhead[CE]{\leftmark}
\renewcommand{\headrulewidth}{0.4pt}

\titleformat{\chapter}[hang]{\heiti\LARGE}
{}{0mm}{\hspace{-0.4cm}\mycont}

\tableofcontents
\cleardoublepage

\mainmatter

\titleformat{\part}[hang]{\heiti\Huge}
{}{0mm}{\hspace{-0.4cm}\mypart}
 
\titleformat{\chapter}[hang]{\heiti\LARGE}
{}{0mm}{\hspace{-0.4cm}\mytitle}
 
\titleformat{\section}[hang]{\heiti\LARGE}
{}{0mm}{\hspace{-0.5cm}\mysection}

\titleformat{\subsection}[hang]{\heiti\large}
{}{0mm}{\hspace{-0.5cm}\mysubsection}

\titleformat{\subsubsection}[hang]{\heiti\large}
{}{0mm}{\hspace{-0.5cm}\mysubsubsection}
 
\titlespacing{\chapter}
{0pc}{1.5ex plus .1ex minus .2ex}{.2pc}

\part[矢量力学]{矢量力学\ (Vectorial Mechanics)}

\input{chapter/vectorial-mechanics/chapter1.tex}%第一章——牛顿力学

\input{chapter/vectorial-mechanics/chapter2.tex}

\part[分析力学]{分析力学\ (Anlaytical Mechanics)}

\input{chapter/chapter2}%第二章——拉格朗日力学

\input{chapter/chapter4}%第三章——两体问题

\input{chapter/chapter5}%第四章——多自由度微振动与阻尼

\input{chapter/chapter6}%第五章——刚体

\input{chapter/chapter8}%第六章——撞击运动理论

\input{chapter/chapter7}%第七章——非惯性系

\input{chapter/chapter3}%第八章——哈密顿力学

\input{chapter/chapter9}%第九章——积分变分原理

\input{chapter/chapter10}%第十章——正则变换、HJ方程

\appendix

\titleformat{\chapter}[hang]{\heiti\LARGE}
{}{0mm}{\hspace{-0.4cm}\myappendix}
 
\titleformat{\section}[hang]{\heiti\LARGE}
{}{0mm}{\hspace{-0.5cm}\appendixsection}

\titleformat{\subsection}[hang]{\heiti\large}
{}{0mm}{\hspace{-0.5cm}\appendixsubsection}

\titleformat{\subsubsection}[hang]{\heiti\large}
{}{0mm}{\hspace{-0.5cm}\appendixsubsubsection}

\renewcommand{\chaptermark}[1]{\markboth{附录\ \ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ \ \rm #1}{}}	%这两个命令第一次必须出现在\pagestyle{fancy}之后，否则\pagestyle{fancy}会覆盖掉其效果
\markboth{\leftmark}{\rightmark}

\input{chapter/exercise}%附录——金尚年《经典力学》

\input{chapter/exercise2}%附录——理论力学习题集

\input{chapter/appendixA.tex}%附录——椭圆函数理论

\backmatter
 
\titleformat{\chapter}[hang]{\heiti\LARGE}
{}{0mm}{\hspace{-0.4cm}\mybackmatter}

\addcontentsline{toc}{chapter}{\listfigurename}{%
\let\oldnumberline\numberline%
\renewcommand{\numberline}{\figurename~\oldnumberline}%
\listoffigures
}

%参考文献
\input{chapter/bibliography.tex}

\end{document}
